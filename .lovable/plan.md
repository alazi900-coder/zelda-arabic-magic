

# ุงุตูุงุญ ูุดููุฉ ุนูุงูุงุช ุงูุงุณุชููุงู "??" ุนูู ุงูุฃุฒุฑุงุฑ

## ุงููุดููุฉ
ุนูุฏ ุฅุฑุณุงู ุงููุตูุต ููุชุฑุฌูุฉ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนูุ ูุชู ุฅุฑุณุงู ุฑููุฒ ุงูุชุญูู ุงูุฎุงุตุฉ ุจูุญุฑู ุงููุนุจุฉ (ุงูุชู ุชุธูุฑ ูู โ๐จ๐ ูู ุงููุญุฑุฑ) ูุจุงุดุฑุฉ ุฅูู Gemini. ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุง ูููู ูุฐู ุงูุฑููุฒ ููุญุฐููุง ุฃู ูุณุชุจุฏููุงุ ููุง ูุคุฏู ูุธููุฑ "??" ุจุฏูุงู ูู ุฃููููุงุช ุงูุฃุฒุฑุงุฑ ูู ุงููุนุจุฉ.

## ุงูุญู
ุชูุณูุน ุฏุงูุฉ `protectTags` ูู ููู `translate-entries/index.ts` ูุชุดูู ุญูุงูุฉ ุฑููุฒ Unicode ุงูุฎุงุตุฉ ุจูุญุฑู ุงููุนุจุฉ (`U+FFF9` ุฅูู `U+FFFC` ู `U+E000-U+E0FF`) ุจุงูุฅุถุงูุฉ ุฅูู ุงูุฃููุงุณ ุงููุฑุจุนุฉ ุงูููุฌูุฏุฉ ุญุงููุงู.

## ุงูุชูุงุตูู ุงูุชูููุฉ

### ุงูููู: `supabase/functions/translate-entries/index.ts`

ุชุนุฏูู ุฏุงูุฉ `protectTags` ูุชุตุจุญ:

```typescript
function protectTags(text: string): { cleaned: string; tags: Map<string, string> } {
  const tags = new Map<string, string>();
  let counter = 0;
  // Protect both [bracket tags] AND Unicode control markers (U+FFF9-FFFC, PUA U+E000-E0FF)
  const cleaned = text.replace(/\[[^\]]*\]|[\uFFF9-\uFFFC\uE000-\uE0FF]+/g, (match) => {
    const placeholder = `TAG_${counter++}`;
    tags.set(placeholder, match);
    return placeholder;
  });
  return { cleaned, tags };
}
```

ุงูุชุบููุฑ ุงููุญูุฏ ูู ุฅุถุงูุฉ `|[\uFFF9-\uFFFC\uE000-\uE0FF]+` ููุชุนุจูุฑ ุงูููุทู (regex) ููุชู:
- ุงูุชูุงุท ูู ุชุณูุณู ูุชุชุงูู ูู ุฑููุฒ ุงูุชุญูู ูุงุณุชุจุฏุงูู ุจุนูุตุฑ ูุงุฆุจ ูุงุญุฏ (ูุซู `TAG_0`)
- ุฅุฑุณุงู ุงููุต ุงููุธูู ููุท ุฅูู Gemini
- ุฅุนุงุฏุฉ ุงูุฑููุฒ ุงูุฃุตููุฉ ูููุงููุง ุจุนุฏ ุงูุชุฑุฌูุฉ ุนุจุฑ ุฏุงูุฉ `restoreTags` ุงูููุฌูุฏุฉ (ุจุฏูู ุชุบููุฑ)

### ูุง ุญุงุฌุฉ ูุชุนุฏูู ูููุงุช ุฃุฎุฑู
ุฏุงูุฉ `restoreTags` ุงูููุฌูุฏุฉ ุชุนูู ุจุดูู ุตุญูุญ ูุฅุนุงุฏุฉ ุฃู ููุน ูู ุงูุนูุงุตุฑ ุงููุงุฆุจุฉ.
