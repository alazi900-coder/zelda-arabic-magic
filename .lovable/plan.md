

# حماية وعرض وسوم `[ML:...]` والوسوم المشابهة

## المشكلة
وسوم محرك اللعبة مثل `[ML:undisp ]` لا يتم التعرف عليها حالياً لأن:
- الـ regex الحالي `\[[\w]+(?::[\w]*)*\]` لا يدعم المسافات داخل الأقواس
- لا تظهر كشارات ملونة مثل رموز PUA
- لا تُحمى أثناء الترجمة الآلية

## التغييرات المطلوبة

### 1. تحديث نمط الحماية (`src/lib/xc3-tag-protection.ts`)
- إضافة نمط regex جديد لوسوم `[ML:...]` بما فيها المسافات: `/\[ML:[^\]]*\]/g`
- إضافة نمط عام للوسوم ذات المسافات: `/\[\w+:[^\]]*\]/g` (يحل محل النمط الحالي المحدود)
- إضافة حماية للأقواس الوصفية المرتبطة: `(description text)` التي تلي وسوم ML مباشرة

### 2. عرض وسوم ML كشارات ملونة (`src/components/editor/types.tsx`)
- تحديث `displayOriginal` لاكتشاف `[ML:...]` وعرضها كشارات مرقمة بلون مميز (مثلاً بنفسجي)
- تحديث regex التقسيم ليشمل أنماط `[ML:...]`
- إضافة تلميح يوضح نوع الوسم (مثل "وسم عرض - لا يظهر في اللعبة")

### 3. تحديث فحص الوسوم التقنية (`src/components/editor/types.tsx`)
- تحديث `hasTechnicalTags` ليشمل فحص `[ML:...]`
- تحديث `isTechnicalText` ليتعرف على النصوص التي هي فقط وسوم ML بدون محتوى حقيقي

### 4. تحديث استعادة الوسوم (`src/lib/xc3-tag-restoration.ts`)
- توسيع `TAG_REGEX` ليشمل أنماط `[ML:...]`

## التفاصيل التقنية

### الأنماط الجديدة المضافة للحماية
```text
/\[ML:[^\]]*\]/g          -- وسوم [ML:undisp ], [ML:Feeling ], إلخ
/\(\w[^)]{0,80}\)/g       -- الأوصاف المرفقة مثل (Crowd noise of children)
```

### عرض الشارات
- وسوم `[ML:...]` تظهر بلون بنفسجي مع أيقونة مثل `[ML]` بدلاً من النص الخام
- الأوصاف بين أقواس `(...)` تظهر بخط صغير رمادي كتوضيح

### الملفات المتأثرة
1. `src/lib/xc3-tag-protection.ts` -- إضافة أنماط regex جديدة
2. `src/components/editor/types.tsx` -- تحديث `displayOriginal` و `hasTechnicalTags`
3. `src/lib/xc3-tag-restoration.ts` -- توسيع TAG_REGEX (اختياري)

