

# خطة: أداة فصل الجمل المندمجة (بدون AI)

## الهدف
إضافة أداة تفحص جميع الترجمات العربية وتكتشف الكلمات/الجمل المندمجة (مثل "مثلكلمة" التي يجب أن تكون "مثل كلمة")، ثم تعرض النتائج للمراجعة قبل التطبيق مع خيارين: موافقة على الكل أو موافقة فردية.

## كيف يعمل الكشف (بدون ذكاء اصطناعي)

الأداة تستخدم قواعد لغوية عربية لاكتشاف الكلمات الملتصقة:

1. **الحروف غير المتصلة**: الحروف (ا، أ، إ، آ، د، ذ، ر، ز، و، ة) لا تتصل بالحرف الذي بعدها. إذا جاء بعدها حرف عربي مباشرة بدون مسافة، فهذا يعني أن هناك كلمتين مندمجتين
2. **أداة التعريف "ال"**: إذا ظهرت "ال" في منتصف كلمة (وليس في بدايتها)، فهذا مؤشر على اندماج
3. **كلمات طويلة جدا**: الكلمات العربية التي تتجاوز 15 حرفا غالبا تكون كلمتين أو أكثر مندمجتين

## واجهة المستخدم

- زر "فصل الجمل المندمجة" في شريط الأدوات
- عند الضغط: يفحص كل الترجمات ويعرض لوحة نتائج
- لوحة النتائج تعرض:
  - النص قبل الإصلاح والنص بعد الإصلاح
  - عدد الاندماجات المكتشفة
  - زر "موافقة على الكل" لتطبيق جميع الإصلاحات دفعة واحدة
  - زر "قبول" و"رفض" لكل نتيجة على حدة

## الملفات المطلوب إنشاؤها/تعديلها

### 1. ملف جديد: `src/lib/arabic-sentence-splitter.ts`
- دالة `detectMergedWords(text: string)` تفحص النص وترجع مواضع الاندماج
- دالة `splitMergedSentences(text: string)` تقوم بالفصل الفعلي
- دالة `scanAllTranslations(translations, entries)` تفحص كل الترجمات وترجع قائمة بالنتائج

### 2. ملف جديد: `src/components/editor/SentenceSplitPanel.tsx`
- مكون يعرض نتائج الفحص بأسلوب مشابه لـ `ConsistencyResultsPanel`
- يعرض كل نتيجة مع النص الأصلي والمصحح
- أزرار قبول/رفض فردية + زر "موافقة على الكل"

### 3. تعديل: `src/hooks/useEditorState.ts`
- إضافة state جديد: `sentenceSplitResults` و `scanningSentences`
- إضافة دالة `handleScanMergedSentences` لبدء الفحص
- إضافة دالة `handleApplySentenceSplit` لتطبيق إصلاح فردي
- إضافة دالة `handleApplyAllSentenceSplits` لتطبيق الكل
- إضافة دالة `handleRejectSentenceSplit` لرفض إصلاح فردي

### 4. تعديل: `src/pages/Editor.tsx`
- إضافة زر "فصل الجمل المندمجة" في شريط الأدوات (بجانب أزرار الأدوات الأخرى)
- إضافة مكون `SentenceSplitPanel` في منطقة عرض النتائج

## التفاصيل التقنية

### خوارزمية الكشف

```text
لكل كلمة عربية (مفصولة بمسافات):
  1. إذا طولها > 15 حرف --> مرشحة للفحص
  2. البحث عن "ال" في منتصف الكلمة (ليس في البداية)
  3. البحث عن حرف غير متصل (ا،د،ذ،ر،ز،و،ة) يتبعه حرف عربي
  4. إذا وُجد نقطة فصل محتملة --> اقتراح الفصل
```

### هيكل البيانات

```text
SentenceSplitResult {
  key: string          // مفتاح الترجمة
  original: string     // النص الإنجليزي الأصلي  
  before: string       // الترجمة قبل الإصلاح
  after: string        // الترجمة بعد الإصلاح
  splits: number       // عدد نقاط الفصل المكتشفة
  status: 'pending' | 'accepted' | 'rejected'
}
```

### تجاهل النصوص التقنية
- تتجاهل الأداة الرموز التقنية (PUA markers) والوسوم عند الفحص
- لا تمس النصوص المحمية من العكس

