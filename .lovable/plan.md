

## خطة تحسين ميزة الإصلاح المحلي للرموز التالفة

### المشكلة الحالية

دالة `restoreTagsLocally` تقارن مجموعات الرموز ككتلة واحدة (مثلاً `\uFFF9\uE000` معاً)، لكن كاشف الرموز التالفة يعد الرموز بشكل فردي. هذا يسبب عدم تطابق بين ما تعتبره الدالة "تم إصلاحه" وما يعتبره الكاشف "لا يزال تالفاً". أيضاً، إدخال الرموز بالمواقع النسبية قد يضعها في أماكن خاطئة داخل النص العربي.

### الحل المقترح

#### 1. تحسين منطق المقارنة والاستعادة
- تغيير المقارنة من مقارنة "الكتل" إلى مقارنة "الرموز الفردية" لتتطابق مع كاشف الجودة
- عد كل رمز تحكم (`\uFFF9`, `\uE000`, إلخ) بشكل مستقل بدلاً من مقارنة سلاسل كاملة

#### 2. تحسين موضع إدراج الرموز
- إدراج الرموز عند حدود الكلمات (المسافات) بدلاً من المواقع النسبية العشوائية
- إذا كان الرمز في بداية النص الأصلي، يوضع في بداية الترجمة
- إذا كان في النهاية، يوضع في النهاية
- باقي الرموز توزع عند أقرب فاصل كلمة

#### 3. إضافة معاينة قبل/بعد
- عرض مقارنة مرئية (النص قبل وبعد الإصلاح) قبل تطبيق التغيير
- يمكن للمستخدم قبول أو رفض كل إصلاح

#### 4. إضافة زر إدراج رمز يدوي
- زر يسمح بنسخ الرموز من النص الأصلي ولصقها يدوياً في الترجمة
- هذا يعطي تحكماً كاملاً عندما لا يعمل الإصلاح التلقائي

---

### التفاصيل التقنية

**الملفات المتأثرة:**

1. **`src/components/editor/types.tsx`** -- تعديل `restoreTagsLocally`:
   - تغيير regex من `+` (كتل) إلى مطابقة فردية
   - تحسين خوارزمية تحديد المواقع لاستخدام حدود الكلمات
   - إضافة دالة `previewTagRestore` تُرجع القبل/البعد بدون تطبيق

2. **`src/components/editor/EntryCard.tsx`** -- إضافة:
   - حالة لعرض معاينة الإصلاح (قبل/بعد)
   - زر "نسخ الرموز" لإدراج يدوي
   - عرض diff ملون عند المعاينة

3. **`src/hooks/useEditorState.ts`** -- تحديث:
   - `handleLocalFixDamagedTag` لدعم المعاينة
   - `handleLocalFixAllDamagedTags` لاستخدام المنطق المحسّن

4. **`src/components/editor/CategoryProgress.tsx`** -- لا تغيير جوهري (الزر موجود)

