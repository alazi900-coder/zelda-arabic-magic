

# زيادة ميزانية البايتات للنصوص العربية

## المشكلة
حالياً يتم حساب حد البايتات (`maxBytes`) بناءً على أطول نص إنجليزي أصلي في العمود × هامش الأمان (20% افتراضياً). بما أن الحرف الإنجليزي = 1 بايت والحرف العربي = 2 بايت في UTF-8، فإن الميزانية الحالية ضيقة جداً للترجمة العربية.

**الأهم:** نظام البناء (bdat-writer) يدعم فعلاً **توسيع جدول النصوص تلقائياً** — أي أن حد البايتات هو **تحذير بصري فقط** وليس حداً تقنياً صلباً يسبب تلف الملف.

## الحل
إضافة **مضاعف عربي** (Arabic Multiplier) يُضاعف ميزانية البايتات تلقائياً عند استخراج النصوص، مع خيار تعديله في الإعدادات.

## التغييرات المطلوبة

### 1. إضافة إعداد المضاعف العربي (`src/lib/bdat-settings.ts`)
- إضافة خاصية `arabicMultiplier` للإعدادات (افتراضي: 2.0، مدى: 1.5–3.0)
- هذا يعني أن ميزانية 100 بايت إنجليزية تصبح 200 بايت للعربية

### 2. تطبيق المضاعف في استخراج النصوص (`src/lib/bdat-parser.ts`)
- في دالة `extractBdatStrings`: ضرب `colMaxBytes` في `arabicMultiplier`
- الصيغة الجديدة: `maxBytes = max_original_bytes × safetyMargin × arabicMultiplier`

### 3. تطبيق المضاعف في فاحص البنية (`src/lib/bdat-schema-inspector.ts`)
- تطبيق نفس المضاعف عند حساب `max_utf8_bytes` و `danger_level`

### 4. إضافة التحكم في واجهة الإعدادات (`src/pages/XenobladeProcess.tsx`)
- إضافة شريط تحكم (Slider) لـ "مضاعف البايتات العربي" بجانب هامش الأمان الحالي
- عرض توضيحي: "×2.0 = الحرف العربي يأخذ ضعف مساحة الإنجليزي"

### 5. إصلاح حساب البايتات في المراجعة السريعة (`src/components/editor/QuickReviewMode.tsx`)
- استبدال `translation.length * 2` بـ `new TextEncoder().encode(translation).length` للتوحيد مع باقي النظام

## التفاصيل التقنية

```text
الصيغة الحالية:  maxBytes = max(ceil(observedMax × 1.2), 4)
الصيغة الجديدة: maxBytes = max(ceil(observedMax × safetyMargin × arabicMultiplier), 4)

مثال: نص إنجليزي أصلي 50 بايت
  الحالي:  50 × 1.2 = 60 بايت (تكفي ~30 حرف عربي فقط)
  الجديد:  50 × 1.2 × 2.0 = 120 بايت (تكفي ~60 حرف عربي)
```

## ملاحظة مهمة
لن يحدث أي تلف للملف حتى لو تجاوزت الترجمة الحد، لأن نظام البناء يوسع جدول النصوص تلقائياً. هذا التعديل يجعل التحذيرات البصرية أكثر واقعية للغة العربية.

