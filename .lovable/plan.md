
# تطبيق تقنيات تعريب الألعاب المتقدمة

## ملخص الخطة
تطبيق خمس تقنيات متقدمة لتحسين جودة تعريب لعبة زيلدا:
1. **تحويل الأرقام إلى أرقام عربية-هندية (٠-٩)**
2. **عكس علامات الترقيم والرموز**
3. **تحسين جودة الترجمة الآلية بالسياق**
4. **كشف النصوص الإنجليزية غير المترجمة**
5. **اقتراح اختصار ذكي عند تجاوز حد البايت**

---

## المرحلة 1: تحويل الأرقام إلى أرقام عربية-هندية

### ملف: `supabase/functions/arabize/index.ts`
**السطور المتأثرة:** بعد دالة `processArabicText`

**التغييرات:**
```
إضافة دالة جديدة:
- convertToArabicNumerals(text): تحول 0-9 إلى ٠-٩
  * تعالج فقط الأرقام خارج الرموز التقنية (PUA markers)
  * تحافظ على الكلمات الإنجليزية والعلامات

- updateProcessArabicText() ليستدعي الدالة الجديدة
  * تطبيق الترتيب: Reshape → BiDi Reversal → Arabic Numerals
```

---

## المرحلة 2: عكس علامات الترقيم

### ملف: `supabase/functions/arabize/index.ts`
**السطور المتأثرة:** بعد دالة `convertToArabicNumerals`

**التغييرات:**
```
إضافة دالة جديدة:
- mirrorPunctuation(text, options):
  * تحول '?' → '؟'، ',' → '،'، ';' → '؛'
  * تبادل الأقواس في السياق العربي: '(' ↔ ')'، '[' ↔ ']'
  * تحافظ على PUA markers والرموز التقنية
  * معامل options للتحكم بتفعيل الميزة
```

---

## المرحلة 3: تحسين جودة الترجمة الآلية بالسياق

### ملف: `supabase/functions/translate-entries/index.ts`
**السطور المتأثرة:** بناء prompt الذكاء الاصطناعي (السطر 73+)

**التغييرات:**
```
تحسين prompt:
1. إضافة معلومات الفئة (Category) من الملف:
   - "هذه نصوص من فئة: أسماء شخصيات"
   - "هذه نصوص من فئة: حوارات القصة"

2. تعليمات الأسلوب حسب نوع النص:
   - حوارات: "استخدم أسلوباً سردياً طبيعياً"
   - واجهات: "استخدم صيغة مختصرة وواضحة"
   - أسماء: "حافظ على الأسماء العلم كما هي أو ترجمها بالطريقة الشهيرة"

3. تعليمات خاصة بألعاب زيلدا:
   - "الحفاظ على المصطلحات الشهيرة (تريفورس، ماستر سورد، إلخ)"
   - "استخدام المصطلحات الموحدة في مجتمع تعريب الألعاب"

4. تعليمات طول الترجمة:
   - "حافظ على طول الترجمة قريباً من الأصلي"
```

---

## المرحلة 4: كشف النصوص الإنجليزية غير المترجمة

### ملف: `supabase/functions/review-translations/index.ts`
**السطور المتأثرة:** إضافة فحص جديد بعد "Glossary term check"

**التغييرات:**
```
إضافة فحص جديد: remaining_english
- الكشف عن الكلمات الإنجليزية المتبقية في الترجمة
- استثناء: الأسماء العلم (Link, Zelda)، المصطلحات التقنية (PUA markers)
- مستوى التحذير: warning

منطق الكشف:
- تحديد قائمة كلمات إنجليزية شائعة في الألعاب
- تجاهل الأحرف الكبيرة الأولى (أسماء شخصيات)
- تجاهل الكلمات ذات 1-2 حرف (a, i, by, on)
```

---

## المرحلة 5: اقتراح اختصار ذكي أثناء الكتابة

### ملف: `src/pages/Editor.tsx`
**السطور المتأثرة:** عند عرض بطاقات النصوص (~1800)

**التغييرات:**
```
1. حساب نسبة البايت الفعلية:
   - عرض شريط تقدم يوضح استخدام البايت (0-100%)
   - تغيير اللون: أخضر < 80%، أصفر 80-100%، أحمر > 100%

2. زر اقتراح اختصار ذكي:
   - يظهر فقط عندما تتجاوز الترجمة 85% من حد البايت
   - عند الضغط: يستدعي review-translations بـ action: "suggest-short"
   - يعرض الاقتراح بجانب الترجمة الحالية

3. تطبيق الاقتراح:
   - زر لتطبيق الاقتراح مباشرة
   - عرض الفرق (عدد البايت المحفوظ)
```

---

## التفاصيل التقنية

### 1. تحويل الأرقام

```typescript
// convertToArabicNumerals(text)
// Input: "Link has 10 hearts and 3 magic points"
// Output: "Link has ١٠ hearts and ٣ magic points" (after reshaping)
// (بعد BiDi: "Link has ١٠ ق و ٣ طقاق" بالعربية المعكوسة)

// تحويل الخريطة
const NUMERAL_MAP: Record<string, string> = {
  '0': '٠', '1': '١', '2': '٢', '3': '٣', '4': '٤',
  '5': '٥', '6': '٦', '7': '٧', '8': '٨', '9': '٩'
};
```

### 2. عكس الترقيم

```typescript
// mirrorPunctuation(text)
// Input: "Hello? (Good job!)"
// Output: "Hello؟ )Good job!()" في السياق العربي
```

### 3. تحسين Prompt

```
إضافة معلومات القاموس والسياق والفئة في طلب API
- يتم بالفعل دعم glossary و context
- إضافة فقط معلومات الفئة والأسلوب
```

### 4. كشف الإنجليزية

```typescript
// كلمات شائعة في ألعاب الفيديو
const COMMON_ENGLISH_WORDS = [
  'attack', 'defense', 'health', 'mana', 'experience',
  'level', 'quest', 'mission', 'boss', 'dungeon', ...
];
```

### 5. واجهة الاقتراح

```
عند الضغط على "اقتراح اختصار":
1. حساب الترجمات التي تتجاوز الحد
2. استدعاء review-translations
3. عرض الاقتراح في modal صغير
4. تطبيق بضغطة واحدة
```

---

## ترتيب التنفيذ

| # | المرحلة | الملف | الأولوية |
|---|--------|------|---------|
| 1 | تحويل الأرقام | `arabize/index.ts` | عالية |
| 2 | عكس الترقيم | `arabize/index.ts` | عالية |
| 3 | تحسين الترجمة | `translate-entries/index.ts` | متوسطة |
| 4 | كشف الإنجليزية | `review-translations/index.ts` | متوسطة |
| 5 | الاقتراح الذكي | `Editor.tsx` | عالية |

---

## الاختبار والتحقق

- **اختبار الأرقام**: رفع ملف يحتوي على أرقام، التحقق من التحويل
- **اختبار الترقيم**: رفع ملف بعلامات ترقيم، التحقق من العكس
- **اختبار الترجمة**: مقارنة جودة الترجمة قبل وبعد إضافة السياق
- **اختبار الكشف**: التحقق من اكتشاف الكلمات الإنجليزية المتبقية
- **اختبار الاقتراح**: محاكاة نص يتجاوز حد البايت

