

# اضافة زر "تطبيق المعالجة العربية" في المحرر

## المشكلة
الخطوتان (ربط الحروف + عكس الاتجاه) موجودتان في الكود وتعملان فقط أثناء البناء النهائي (Build). لكن المستخدم يريد زراً يطبقهما مباشرة على الترجمات داخل المحرر ليرى النتيجة ويتأكد قبل البناء.

## الحل
اضافة زر "تطبيق المعالجة العربية" في المحرر يقوم بالتالي:
1. يأخذ كل الترجمات الحالية
2. يطبق عليها **ربط الحروف** (Reshaping) و**عكس الاتجاه** (BiDi Reversal)
3. يحفظ النتيجة في الترجمات مباشرة

هذا يعني ان الترجمات ستصبح جاهزة للعبة حتى لو استخدم المستخدم اداة خارجية لحقنها.

## التغييرات

### 1. اضافة دالة معالجة عربية في الواجهة (Client-Side)
**ملف:** `src/pages/Editor.tsx`

- نسخ دوال `reshapeArabic` و `reverseBidi` و `processArabicText` من ملف `arabize/index.ts` الى ملف مساعد جديد `src/lib/arabic-processing.ts`
- هذا يسمح بتطبيق المعالجة محلياً بدون استدعاء الخادم

### 2. ملف جديد: `src/lib/arabic-processing.ts`
- نسخ الدوال التالية من `supabase/functions/arabize/index.ts`:
  - `isArabicChar`
  - `hasArabicChars`
  - `hasArabicPresentationForms`
  - `ARABIC_FORMS` (جدول اشكال الحروف)
  - `LAM_ALEF_LIGATURES`
  - `canConnectAfter`
  - `isTashkeel`
  - `reshapeArabic`
  - `reverseBidi`
  - `convertToArabicNumerals`
  - `mirrorPunctuation`
  - `processArabicText`
- تصدير `processArabicText` كدالة رئيسية

### 3. تعديل المحرر: `src/pages/Editor.tsx`
- اضافة زر "تطبيق المعالجة العربية" بجانب زر البناء (او في قائمة الادوات)
- عند الضغط:
  - يمر على كل الترجمات غير الفارغة
  - يتخطى النصوص التي تحتوي بالفعل على Presentation Forms (لتجنب المعالجة المزدوجة)
  - يطبق `processArabicText` على كل ترجمة
  - يحدث الترجمات في الحالة (state)
  - يعرض رسالة نجاح بعدد النصوص المعالجة

### 4. شكل الزر
- ايقونة مناسبة (مثل Sparkles او RotateCcw)
- نص: "تطبيق المعالجة العربية"
- يظهر بجانب ازرار الادوات الاخرى
- يعرض تأكيد قبل التطبيق (لان العملية لا يمكن التراجع عنها بسهولة)

## ملاحظات
- بعد تطبيق المعالجة، النصوص في المحرر ستظهر "معكوسة" وبحروف متصلة - وهذا طبيعي لان هذا ما تحتاجه اللعبة
- زر البناء سيتخطى المعالجة تلقائياً للنصوص التي تحتوي على Presentation Forms (الكود موجود بالفعل)
- يمكن للمستخدم تصدير الترجمات كـ JSON واستخدامها مع اداة خارجية

