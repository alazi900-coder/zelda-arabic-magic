

# خطة: ترجمة الصفحة واحدة تلو الأخرى مع عرض مقارنة

## المشكلة
عند ترجمة الصفحة كاملة، يتم إرسال 10 نصوص دفعة واحدة للذكاء الاصطناعي مما يسبب خلط بعض الكلمات الإنجليزية في الترجمة. بينما ترجمة كل نص على حدة تعطي نتائج أدق.

## الحل
تغيير "ترجمة الصفحة" لتعمل بأسلوب "نص واحد في كل مرة" مع عرض شاشة مقارنة قبل تطبيق النتائج.

## التغييرات المطلوبة

### 1. تعديل `handleTranslatePage` في `src/hooks/useEditorTranslation.ts`
- بدلا من إرسال دفعات (batches) من 10 نصوص، سيتم إرسال نص واحد فقط في كل طلب
- تخزين الترجمات الجديدة في متغير مؤقت (`pendingPageTranslations`) بدون تطبيقها فورا
- حفظ الترجمات القديمة للمقارنة
- إرسال سياق (النصوص المجاورة المترجمة) مع كل نص لتحسين الدقة كما يحدث في الترجمة المفردة
- عرض تقدم واضح: "ترجمة 3/25..."

### 2. إضافة حالة المقارنة (state) في `useEditorTranslation`
- `pendingPageTranslations`: الترجمات الجديدة المعلقة (لم تُطبق بعد)
- `oldPageTranslations`: الترجمات القديمة قبل التغيير
- `showPageCompare`: لإظهار/إخفاء نافذة المقارنة
- `applyPendingTranslations()`: دالة لتطبيق الترجمات عند الموافقة
- `discardPendingTranslations()`: دالة لإلغاء الترجمات

### 3. إنشاء مكون `PageTranslationCompare` في `src/components/editor/PageTranslationCompare.tsx`
- نافذة مقارنة تعرض جدولا بثلاثة أعمدة:
  - النص الأصلي (الإنجليزي)
  - الترجمة السابقة (إن وجدت)
  - الترجمة الجديدة
- تلوين الاختلافات بين القديم والجديد
- عداد إجمالي: "25 نص مترجم"
- زر "موافقة - تطبيق الكل" وزر "إلغاء - تجاهل"
- إمكانية رفض ترجمات فردية (checkbox لكل سطر)

### 4. تعديل `src/pages/Editor.tsx`
- ربط مكون المقارنة الجديد بحالة `showPageCompare`
- تمرير دوال الموافقة والإلغاء

### 5. تعديل `src/hooks/useEditorState.ts`
- تصدير الحالات والدوال الجديدة للمحرر

## التفاصيل التقنية

```text
سير العمل الجديد:
                                          
  [ضغط "ترجمة الصفحة"]                    
         |                                 
         v                                 
  [ترجمة نص 1/25 ...]  --> طلب API منفرد   
  [ترجمة نص 2/25 ...]  --> طلب API منفرد   
  [ترجمة نص 3/25 ...]  --> طلب API منفرد   
         ...                               
  [ترجمة نص 25/25]                         
         |                                 
         v                                 
  [عرض شاشة المقارنة]                      
    - القديم vs الجديد                      
    - اختيار/إلغاء لكل سطر                 
         |                                 
    [موافقة]  أو  [إلغاء]                  
         |            |                    
    تطبيق       تجاهل الكل                
```

- كل طلب يرسل نصا واحدا مع سياق (4 نصوص مجاورة مترجمة) تماما مثل `handleTranslateSingle`
- الترجمات تُخزن مؤقتا ولا تُطبق حتى يوافق المستخدم
- يمكن إيقاف الترجمة في أي وقت والمقارنة بما تم ترجمته حتى الآن

